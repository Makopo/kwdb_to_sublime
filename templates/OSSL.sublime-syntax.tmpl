%YAML 1.2
---

# NOTE:   Following definitions are taken from kwdb (https://bitbucket.org/Sei_Lisa/kwdb).
#         Should you have any question about the avoid/event/function/constant
#         definitions, please check with the kwdb project and contact the kwdb
#         maintainer first. If kwdb have updated their database version and mine is
#         still old, please let me know.

# Generated by LSL2 Derived Files Generator. Database version: [@--$version--@]

name: OSSL
file_extensions:
  - ossl
scope: source.ossl
contexts:
  main:
    - include: value
  array:
    - match: '\['
      captures:
        0: punctuation.definition.array.begin.ossl
      push:
        - meta_scope: meta.inarray.ossl
        - match: '\]'
          captures:
            0: punctuation.definition.array.end.ossl
          pop: true
        - include: infunc
  avoid:
    - match: '\b[@--$invalids--@]\b'
      scope: invalid.deprecated.ossl
  begin_end:
    - match: '\{'
      push:
        - meta_scope: meta.incode.ossl
        - match: '\}'
          pop: true
        - include: infunc
  commentblock:
    - match: /\*
      push:
        - meta_scope: comment.block.ossl
        - match: \*/
          pop: true
  commentline:
    - match: (//).*$\n?
      scope: comment.line.double-slash.ossl
  constant:
    - match: \b(default|state)\b
      scope: constant.language.state.ossl
    - match: \b(TRUE|FALSE)\b
      scope: constant.language.integer.ossl
    - match: \b(NULL_KEY|EOF)\b
      scope: constant.language.string.ossl
  event:
    - match: ^\s*[@--$valid_events--@]\b
      captures:
        0: support.function.event.ossl
      push:
        - meta_scope: meta.event.ossl
        - match: '\}'
          captures:
            0: punctuation.definition.event.end.ossl
          pop: true
        - match: \(
          push:
            - meta_scope: meta.event.parameters.ossl
            - match: \)
              pop: true
            - include: inparam
        - match: '{'
          push:
            - meta_scope: meta.event.body.ossl
            - match: '(?=})'
              pop: true
            - include: infunc
        - include: commentblock
        - include: commentline
  flow_control:
    - match: \b(jump|return|if|else|for|do|while|@)\b
      scope: keyword.control.flow.ossl
  functiondef:
    - match: (?:\w+\s+)?(\w+)?\s*(?=\(.*?)
      captures:
        0: punctuation.definition.function.begin.ossl
        1: entity.name.function.ossl
      push:
        - meta_scope: meta.function.ossl
        - match: '}'
          captures:
            0: punctuation.definition.function.end.ossl
          pop: true
        - match: \(
          push:
            - meta_scope: meta.function.parameters.ossl
            - match: \)
              pop: true
            - include: inparam
        - match: '{'
          push:
            - meta_scope: meta.function.body.ossl
            - match: '(?=})'
              pop: true
            - include: infunc
        - include: commentblock
        - include: commentline
  infunc:
    - include: begin_end
    - include: commentblock
    - include: commentline
    - include: array
    - include: quoted
    - include: flow_control
    - include: constant
    - include: storage_type
    - include: osslconstant
    - include: avoid
    - include: reserved
    - include: osslfunction
    - include: number
    - include: operator
  inparam:
    - include: storage_type
    - include: commentblock
    - include: commentline
  number:
    - match: '\b(?i:(\d+\.\d*(e[\-\+]?\d+)?))(?=[^a-zA-Z_])'
      scope: constant.numeric.float.ossl
    - match: '(?<=[^0-9a-zA-Z_])(?i:(\.\d+(e[\-\+]?\d+)?))'
      scope: constant.numeric.float.ossl
    - match: '\b(?i:(\d+e[\-\+]?\d+))'
      scope: constant.numeric.float.ossl
    - match: \b(?i:(0x\h*))
      scope: constant.numeric.integer.hexadecimal.ossl
    - match: '\b(0[0-7]+)'
      scope: constant.numeric.integer.octal.ossl
    - match: '\b([1-9]+[0-9]*|0)'
      scope: constant.numeric.integer.decimal.ossl
  operator:
    - match: '[\=\+\-%&<>^|\*!~]'
      scope: keyword.operator.ossl
  osslconstant:
    - match: '\b[@--$valid_constants--@]\b'
      scope: constant.language.ll.integer.ossl
    - match: \b(TEXTURE_(BLANK|DEFAULT|MEDIA|PLYWOOD|TRANSPARENT))\b
      scope: constant.language.ll.string.ossl
    - match: \b(PI|TWO_PI|PI_BY_TWO|DEG_TO_RAD|RAD_TO_DEG|SQRT2)\b
      scope: constant.language.ll.float.ossl
    - match: \b(ZERO_(VECTOR|ROTATION))\b
      scope: constant.language.ll.compound.ossl
  osslfunction:
    - match: '\b[@--$valid_functions--@]\b'
      scope: support.function.ll.ossl
  quoted:
    - match: '"'
      captures:
        0: punctuation.definition.string.begin.ossl
      push:
        - meta_scope: string.quoted.double.ossl
        - match: '"'
          captures:
            0: punctuation.definition.string.end.ossl
          pop: true
        - match: '\\(x\h{2}|[0-2][0-7]{,2}|3[0-6][0-7]|37[0-7]?|[4-7][0-7]?|.)'
          scope: constant.character.escape.ossl
  reserved:
    - match: \b(event|print)\b
      scope: variable.language.ossl
  state:
    - match: ^\s*((?:state)\s+\w+|default)\b
      captures:
        0: entity.name.class.state.begin.ossl
      push:
        - meta_scope: meta.state.ossl
        - match: '\}'
          captures:
            0: punctuation.definition.state.end.ossl
          pop: true
        - match: '{'
          push:
            - meta_scope: meta.state.body.ossl
            - match: '(?=})'
              pop: true
            - include: commentblock
            - include: commentline
            - include: event
        - include: commentblock
        - include: commentline
  storage_type:
    - match: \b(integer|float|string|key|vector|quaternion|rotation|list)\b
      scope: storage.type.ossl
  value:
    - include: commentblock
    - include: commentline
    - include: state
    - include: storage_type
    - include: quoted
    - include: constant
    - include: reserved
    - include: number
    - include: operator
    - include: array
    - include: functiondef
